<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog LocalStorage Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Blog LocalStorage Test</h1>
    
    <div class="test-section">
        <h3>1. Initialize Database</h3>
        <button onclick="initializeDB()">Initialize Database</button>
        <div id="init-result"></div>
    </div>

    <div class="test-section">
        <h3>2. Create Test Post</h3>
        <button onclick="createTestPost()">Create Test Post</button>
        <div id="create-result"></div>
    </div>

    <div class="test-section">
        <h3>3. Get All Posts</h3>
        <button onclick="getAllPosts()">Get All Posts</button>
        <div id="get-result"></div>
    </div>

    <div class="test-section">
        <h3>4. Update Post</h3>
        <button onclick="updateTestPost()">Update Test Post</button>
        <div id="update-result"></div>
    </div>

    <div class="test-section">
        <h3>5. Delete Post</h3>
        <button onclick="deleteTestPost()">Delete Test Post</button>
        <div id="delete-result"></div>
    </div>

    <div class="test-section">
        <h3>6. Clear All Data</h3>
        <button onclick="clearAllData()">Clear All Data</button>
        <div id="clear-result"></div>
    </div>

    <script>
        // Mock API Service for testing
        class MockApiService {
            constructor() {
                this.mockPosts = [];
                this.initializeDatabase();
            }

            initializeDatabase() {
                const db = this.getDatabase();
                if (!db.users || db.users.length === 0) {
                    db.users = [
                        {
                            id: 1,
                            name: "Admin User",
                            email: "admin@devinquire.com",
                            password: this.hashPassword("admin123"),
                            role: "admin",
                            status: "approved",
                            created_at: new Date().toISOString(),
                            updated_at: new Date().toISOString(),
                        },
                    ];
                    this.saveDatabase(db);
                }
            }

            getDatabase() {
                const db = localStorage.getItem("devinquireDB");
                return db ? JSON.parse(db) : { users: [], pendingUsers: [] };
            }

            saveDatabase(db) {
                localStorage.setItem("devinquireDB", JSON.stringify(db));
            }

            hashPassword(password) {
                return btoa(password + "salt");
            }

            createPostInLocalStorage(postData) {
                const newPost = {
                    id: Date.now(),
                    ...postData,
                    created_at: new Date().toISOString(),
                    updated_at: new Date().toISOString(),
                    views: 0,
                    likes: 0,
                };

                this.mockPosts.unshift(newPost);
                return { success: true, data: newPost };
            }

            getPostsFromLocalStorage(page = 1, limit = 10, category = null, status = null) {
                let filteredPosts = [...this.mockPosts];

                if (category) {
                    filteredPosts = filteredPosts.filter(post => post.category === category);
                }

                if (status) {
                    filteredPosts = filteredPosts.filter(post => post.status === status);
                }

                const startIndex = (page - 1) * limit;
                const endIndex = startIndex + limit;
                const paginatedPosts = filteredPosts.slice(startIndex, endIndex);

                return {
                    success: true,
                    data: {
                        posts: paginatedPosts,
                        total: filteredPosts.length,
                        page: page,
                        limit: limit,
                        totalPages: Math.ceil(filteredPosts.length / limit),
                    },
                };
            }

            updatePostInLocalStorage(id, postData) {
                const index = this.mockPosts.findIndex(p => p.id === parseInt(id));
                if (index === -1) {
                    throw new Error("Post not found");
                }

                this.mockPosts[index] = {
                    ...this.mockPosts[index],
                    ...postData,
                    updated_at: new Date().toISOString(),
                };

                return { success: true, data: this.mockPosts[index] };
            }

            deletePostFromLocalStorage(id) {
                const index = this.mockPosts.findIndex(p => p.id === parseInt(id));
                if (index === -1) {
                    throw new Error("Post not found");
                }

                const deletedPost = this.mockPosts.splice(index, 1)[0];
                return { success: true, data: deletedPost };
            }
        }

        const apiService = new MockApiService();

        function initializeDB() {
            try {
                apiService.initializeDatabase();
                const db = apiService.getDatabase();
                document.getElementById('init-result').innerHTML = 
                    `<div class="success">✓ Database initialized successfully. Users: ${db.users.length}</div>`;
            } catch (error) {
                document.getElementById('init-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        function createTestPost() {
            try {
                const postData = {
                    title: "Test Blog Post",
                    excerpt: "This is a test excerpt for the blog post.",
                    content: "This is the full content of the test blog post. It contains multiple sentences to test the functionality.",
                    category: "Web Development",
                    tags: ["test", "blog", "javascript"],
                    featured_image: "https://via.placeholder.com/400x300/3B82F6/FFFFFF?text=Test+Image",
                    status: "published",
                    author_name: "Test Author",
                    readTime: "3 min read"
                };

                const result = apiService.createPostInLocalStorage(postData);
                document.getElementById('create-result').innerHTML = 
                    `<div class="success">✓ Post created successfully! ID: ${result.data.id}</div>
                     <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('create-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        function getAllPosts() {
            try {
                const result = apiService.getPostsFromLocalStorage();
                document.getElementById('get-result').innerHTML = 
                    `<div class="success">✓ Retrieved ${result.data.posts.length} posts</div>
                     <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('get-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        function updateTestPost() {
            try {
                if (apiService.mockPosts.length === 0) {
                    document.getElementById('update-result').innerHTML = 
                        `<div class="error">✗ No posts to update. Create a post first.</div>`;
                    return;
                }

                const postId = apiService.mockPosts[0].id;
                const result = apiService.updatePostInLocalStorage(postId, {
                    title: "Updated Test Blog Post",
                    status: "draft"
                });

                document.getElementById('update-result').innerHTML = 
                    `<div class="success">✓ Post updated successfully!</div>
                     <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('update-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        function deleteTestPost() {
            try {
                if (apiService.mockPosts.length === 0) {
                    document.getElementById('delete-result').innerHTML = 
                        `<div class="error">✗ No posts to delete. Create a post first.</div>`;
                    return;
                }

                const postId = apiService.mockPosts[0].id;
                const result = apiService.deletePostFromLocalStorage(postId);

                document.getElementById('delete-result').innerHTML = 
                    `<div class="success">✓ Post deleted successfully!</div>
                     <pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('delete-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        function clearAllData() {
            try {
                localStorage.removeItem("devinquireDB");
                localStorage.removeItem("authToken");
                localStorage.removeItem("currentUserEmail");
                apiService.mockPosts = [];
                document.getElementById('clear-result').innerHTML = 
                    `<div class="success">✓ All data cleared successfully!</div>`;
            } catch (error) {
                document.getElementById('clear-result').innerHTML = 
                    `<div class="error">✗ Error: ${error.message}</div>`;
            }
        }

        // Auto-initialize on load
        window.onload = function() {
            initializeDB();
        };
    </script>
</body>
</html> 